@using System.Web.Mvc;
@using KISD.Areas.Admin.Models;
@using System.Data;
@model NewsEventModel
@using NewsEventTypeAlias = KISD.Areas.Admin.Models.GalleryListingService.TypeMaster;

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    string Listingtype = Convert.ToString(ViewBag.ImageTypeId) ?? string.Empty;
    var TypeMasterID = Request.QueryString["mt"] != null ? Request.QueryString["mt"].ToString() : EncryptDecrypt.Encrypt("0");
    var type = EncryptDecrypt.Decrypt(TypeMasterID);
    var SortColumn = Request.QueryString["Column"] != null ? Request.QueryString["Column"].ToString() : "EventCreateDate";
    var SortDirection = Request.QueryString["Direction"] != null ? Request.QueryString["Direction"].ToString() : "Descending";
    var Pagesize = Request.QueryString["pagesize"] != null ? Request.QueryString["pagesize"].ToString() : Common._pageSize.ToString();
    var PagerID = Request.QueryString["page"] != null ? Request.QueryString["page"].ToString() : Common._currentPage.ToString();
    var AppPath = (Request.IsSecureConnection ? "https://" : "http://") + (HttpContext.Current.Request.Url.DnsSafeHost) + (HttpContext.Current.Request.IsLocal ?
            (":" + HttpContext.Current.Request.Url.Port.ToString()) : "") + "/Admin/";
    AppPath = Common.ReturnValidPath(AppPath);
}

@using (Html.BeginForm("ImportEvents", "NewsEvent", new
{
    mt = Request.QueryString["mt"] != null ? Request.QueryString["mt"].ToString() : EncryptDecrypt.Encrypt("0"),
    nid = Request.QueryString["nid"] != null ? Request.QueryString["nid"].ToString() : EncryptDecrypt.Encrypt("0"),
    pid = Request.QueryString["pid"] != null ? Request.QueryString["pid"].ToString() : EncryptDecrypt.Encrypt("0"),
    pagesize = Pagesize,
    page = PagerID,
    Column = SortColumn,
    Direction = SortDirection
},
                                      FormMethod.Post, new { id = "form1", name = "form1", enctype = "multipart/form-data",autocomplete = "off"}))
{
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <ul>
            <li>
                <i class="icon-th"></i>
                <a id="ankdahboard" href='@Url.Action("Index", "Home")'>Dashboard</a>
            </li>
@if (Convert.ToInt32(EncryptDecrypt.Decrypt(TypeMasterID)) == Convert.ToInt32(NewsEventTypeAlias.ManageEvents))
{
            <li>
                <a id="ankbacktoMasterListing" href='@Url.Action("DepartmentListing", "Department", new
                                                {
                                                    pagesize = Request.QueryString["mpagesize"] ?? "10",
                                                    page = Request.QueryString["mpage"] ?? "1",
                                                    Column = Request.QueryString["mColumn"] ?? "DepartmentCreateDate",
                                                    Direction = Request.QueryString["mDirection"] ?? "Descending"
                                                })'>
                    Department Listing
                </a>
            </li>
}
            <li>
                <a id="anklisting" href='@Url.Action("Index", "NewsEvent", new
                                     {
                                         mt = TypeMasterID,
                                         nid = Request.QueryString["nid"] != null ? Request.QueryString["nid"].ToString() : EncryptDecrypt.Encrypt("0"),
                                         pid = Request.QueryString["pid"] != null ? Request.QueryString["pid"].ToString() : EncryptDecrypt.Encrypt("0"),
                                         pagesize = Pagesize,
                                         page = PagerID,
                                         Column = SortColumn,
                                         Direction = SortDirection
                                     })'>@Html.Raw(Convert.ToString(ViewBag.ImageTypeTitle)) Listing</a>
            </li>
            <li>
                @Html.Raw(Convert.ToString(@ViewBag.PageTitle))
            </li>
        </ul>
    </div>
    <!-- Breadcrumb Ends -->

      <!-- page-header -->
    <div class="page-header">
        <div class="page-title">
        </div>
    </div>
      <!-- page-header -->

    <!-- Wrapper -->
    <div class="wrapper">
        <!-- Wrapper -->
        <div class="widget">
            <!-- widget -->
            <div class="widget-header">
                <!-- widget-header -->
                <h4><i class="icon-reorder"></i>@Html.Raw(Convert.ToString(@ViewBag.PageTitle)) </h4>
                <div class="btn-group">
                    <a id="ankback" href='@Url.Action("Index", "NewsEvent", new
                                     {
                                         mt = TypeMasterID,
                                         nid = Request.QueryString["nid"] != null ? Request.QueryString["nid"].ToString() : EncryptDecrypt.Encrypt("0"),
                                         pid = Request.QueryString["pid"] != null ? Request.QueryString["pid"].ToString() : EncryptDecrypt.Encrypt("0"),
                                         pagesize = Pagesize,
                                         page = PagerID,
                                         Column = SortColumn,
                                         Direction = SortDirection
                                     })'>
                        <i class="icon-arrow-left"></i>Back
                    </a>
                </div>
            </div>
            @if (Model.TypeMasterID == Convert.ToInt64(NewsEventTypeAlias.ManageEvents))
            {
                    <div class="row dvimage" id="dvimage">
                        <div class="col20">
                            <label>
                                Upload Events:<span class="requiredstar">*</span>
                            </label>
                        </div>
                        <div class="col40">
                            <input type="file" value="" accept=".csv"
                                   @if (Model != null && !string.IsNullOrEmpty(Model.ImageURLTxt))
                                   { <text> class="" name="imageupload" id="imageupload" </text>                 }
                                   else
                                   { <text> class="fileinput required" id="ImagePathTxt" name="ImagePathTxt" </text>    } />
                            <span class="fontsize">

                                <text>Only CSV files are allowed and maximum file size is 4 MB.</text>


                            </span>
                            <span class="field-validation-error" style="display: none;" id="input_file_upload_error_img"></span>
                            <span class="field-validation-error" style="display: none;" id="input_file_upload_error_img1">This field is required.</span>
                            <br />
                            @if (Model != null && !string.IsNullOrEmpty(Model.ImageURLTxt))
                            {
                                <div id="modelimage">
                                    @Html.Raw(string.Format("<text><img src=\"{0}\" alt=\"Image\" height=\"60px\"  width=\"100px\" /></text>", Url.Content(@Href(Model.ImageURLTxt).Replace("images", "thumbnails"))))
                                </div>

                            }
                        </div>
                    </div>
                                                    <div class="row">
                                                        <div class="col20">
                                                            <label>
                                                                Date Added:<span class="requiredstar">*</span>
                                                            </label>
                                                        </div>
                                                        <div class="col40">
                                                            @Html.TextBoxFor(m => m.EventCreateDate, new
                                                       {
                                                           @Value = ViewBag.Date,
                                                           maxlength = "10",
                                                           @class = "nospace datepicker dateonly",
                                                           @readonly = true,
                                                           @placeholder = "MM/DD/YYYY",
                                                           @id = "ListingCreateDate",
                                                           ondrop = "return false;",
                                                           onpaste = "return false;"
                                                       })
                                                            <br />
                                                            @Html.ValidationMessageFor(m => m.EventCreateDate)
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col20">&nbsp;</div>
                                                        <div class="col40">
                                                            @Html.HiddenFor(m => m.NewsEventID)
                                                            @Html.HiddenFor(m => m.TypeMasterID)
                                                            @Html.HiddenFor(m => m.DepartmentID)
                                                        
                                                        <input type="submit" id="btnsubmit" value="@ViewBag.Submit"
                                                               class="submit-btn submit" />&nbsp;&nbsp;&nbsp;
                                                        <input type="submit" id="btnCancel" name="command" value="Cancel"
                                                               class="cancel cancel-btn" />
                                                    </div></div>
                if (Model != null)
                {
                    if (Model.dsError.Tables.Count > 0)

                    {
                        
                        <div class="err_messages" id="err_messages" tabindex="1">
                            <div class="col20">&nbsp;</div>
                            <div class="col40">
                                @if (Model.dsError.Tables["ErrorMsg"].Rows.Count > 0)
                                {
                                    foreach (DataRow dr in Model.dsError.Tables["ErrorMsg"].Rows)
                                    {
                                        <span class="full-width @((!string.IsNullOrEmpty(dr["ErrMsgType"].ToString()) ? "success" : ""))"><strong>@(!string.IsNullOrEmpty(dr["ErrMsgType"].ToString()) ? "Success" : Model.dsError.Tables["ErrorMsg"].Rows.Count > 1 ? "Error " + dr["ErrMsgID"] : "Error ") :</strong><span class="dser-con">@Html.Raw(dr["ErrMsgTxt"])</span></span>
                                    }
                                    if (Model.dsError.Tables.Count > 1)
                                    {
                                        if (Model.dsError.Tables["Errorlog"].Rows.Count > 0)
                                        {
                                            <div class="warning03">
                                                <div class="excel_table">
                                                    <table class="report_output" style="width: 2200px;">
                                                        <thead>

                                                            <tr>
                                                                @foreach (DataColumn dc in Model.dsError.Tables["Errorlog"].Columns)
                                                                {
                                                                    <th>@dc.ColumnName</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (DataRow dr in Model.dsError.Tables["Errorlog"].Rows)
                                                            {
                                                                <tr>
                                                                    <td class="name">@dr[0]</td>
                                                                    <td>@dr[1]</td>
                                                                    <td>@dr[2]</td>
                                                                    <td>@dr[3]</td>
                                                                    <td>@dr[4]</td>
                                                                    <td>@dr[5]</td>
                                                                    <td>@dr[6]</td>
                                                                    <td>@dr[7]</td>
                                                                    <td>@dr[8]</td>
                                                                    <td>@dr[9]</td>
                                                                    <td>@dr[10]</td>
                                                                    <td>@dr[11]</td>
                                                                    <td>@dr[12]</td>
                                                                    <td>@dr[13]</td>
                                                                    <td>@dr[14]</td>
                                                                    <td>@dr[15]</td>
                                                                    <td>@dr[16]</td>
                                                                    <td>@dr[17]</td>
                                                                    <td>@dr[18]</td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        }
                                    }
                                }
                            </div>
                        </div>

                        <div class="admin-btn-container">
                            @if (Model.dsError.Tables.Count > 1)
                            {
                                if (Model.dsError.Tables["Errorlog"].Rows.Count > 0)
                                {
                                    <a href="#"><img id="btnExport" src="~/scripts/Admin/images/export_Excel.png" title="Export in Excel" alt="" /></a>
                                }
                            }


                        </div>
                    }
                }
                // Div for blocking the user untill the page is not fully loaded.
                                                    <div id="div" style="position:fixed; bottom:0; height:100%; width:100%; left:0; right:0; top:0; opacity:0.5; background-color:#000; color:#fff; z-index:9999;">

                                                    </div>
            }
        </div>
    </div>
    <script src="~/Scripts/js/jquery-1.10.2.js" type="text/javascript"></script>
    <script src="~/Scripts/js/jquery.validate.js" type="text/javascript"></script>
    <script src="~/Scripts/js/jquery.validate.unobtrusive.js" type="text/javascript"></script>
    @*<script src="~/Scripts/js/additional-methods.js" type="text/javascript"></script>*@
                                                    <script src="@Href(" ~/Scripts/js/ckeditor/ckeditor.js")"></script>
                                                    <script src="@Href(" ~/Scripts/js/custom-validate.js")"></script>
                                                    <script type="text/javascript" src="@Href(" ~/Scripts/js/ckfinder/ckfinder.js")"></script>
                                                    <script src="~/Scripts/js/jquery-ui-1.11.2.min.js"></script>
                                                    <link href="~/Scripts/admin/css/jquery.datetimepicker.min.css" rel="stylesheet" />
                                                    <script type="text/javascript" src="~/Scripts/js/jquery.datetimepicker.full.min.js"></script>
                                                    <script src="~/Scripts/js/Fileuploder.js"></script>
                                                    <script type="text/javascript">
                                                        // code for blocking the user untill the page is not fully loaded.
                                                        $(document).ready(function () {
                                                            $("#div").fadeOut();
                                                            var type = '@EncryptDecrypt.Decrypt(TypeMasterID)';
                                                            if (type == "8") {
                                                                $("#ankMasters").addClass('select');
                                                                $('#anknews').addClass('select');
                                                            }
                                                            else if (type == "9") {
                                                                $('#ankMasters').addClass('select');
                                                                $('#ankevents').addClass('select');
                                                            }
                                                            else if (type == "18") {
                                                                $('#ankDepartments').addClass('select');
                                                                $('#ankDepartmentsListing').addClass('select');
                                                            }
                                                            if ($("#IsExternalLinkInd").val() == "false") {
                                                                $('#TitleTxt').on('change keyup', function () {
                                                                    var url = this.value;
                                                                    $.ajax({
                                                                        url: '@(Url.Action("CheckURL"))',
                                                                        type: 'POST',
                                                                        data: JSON.stringify({ url: url.replace(/[\W_]/g, '_') }),
                                                                        dataType: 'json',
                                                                        contentType: 'application/json',
                                                                        success: function (data) {
                                                                            if (data != "" || data != null) {
                                                                                if ($("#IsExternalLinkInd").val() == "false") {
                                                                                    $("#PageURLTxt").val(data.toString().toLowerCase());
                                                                                }
                                                                            }
                                                                        }
                                                                    });
                                                                });
                                                            }
                                                            
                                                        });
                                                        var isactive = '@Model.IsExternalLinkInd';
                                                        var $ = jQuery.noConflict();
                                                        $(document).ready(function () {
                                                            var nospace = $(".nospace");
                                                            var funcfb = function () {
                                                                $(this).val($(this).val().replace(/\s/g, ''));
                                                            }
                                                            if (nospace != null && nospace.length > 0) {
                                                                nospace.keyup(funcfb).blur(funcfb);
                                                            }
                                                            var type = '@EncryptDecrypt.Decrypt(TypeMasterID)';
                                                            if (type != "18") {
                                                                if ($("#ckDescriptionTxt").length != 0) {
                                                                    var editor = CKEDITOR.replace('ckDescriptionTxt');
                                                                    CKEDITOR.config.allowedContent = true;
                                                                    CKFinder.setupCKEditor(editor, { basePath: '@Href("~/Scripts/js/ckfinder/")', rememberLastFolder: false })
                                                                }
                                                                if ($("#minickDescriptionTxt").length != 0) {
                                                                    CKEDITOR.replace('minickDescriptionTxt', { toolbar: 'Basic', BasePath: '@Href("~/Scripts/js/ckeditor/'")' });
                                                                    CKEDITOR.config.allowedContent = true;
                                                                }
                                                                // for mini ck for header and footer for home page
                                                                if ($("#tdCkEditor").length != 0) {
                                                                    CKEDITOR.replace('BannerImageAbstractTxt',
                                                                       {
                                                                           toolbar: 'Basic',
                                                                           BasePath: '@Href("~/Scripts/js/ckeditor/'")'
                                                                       });
                                                                    CKEDITOR.config.allowedContent = true;
                                                                }
                                                            }
                                                            setform(isactive);
                                                            $('#IsActiveInd').removeClass('input-validation-error');
                                                            var isrecurring = '@Model.IsRecurringInd'
                                                            if (isrecurring == "" || isrecurring == "False") {
                                                                $(".recurring").hide();
                                                                $(".weekly").hide();
                                                                $(".monthly").hide();
                                                                $(".recurringenddate").hide();
                                                            }
                                                            else {
                                                                $(".recurring").show();
                                                                var recurringnbr = '@Model.RecurrenceTypeNbr'
                                                                if (recurringnbr == "2") {
                                                                    $(".weekly").show();
                                                                    $(".monthly").hide();
                                                                }
                                                                else if (recurringnbr == "3") {
                                                                    $(".monthly").show();
                                                                    $(".weekly").hide();
                                                                    var monthmodenbr = '@Model.MonthModeNbr'
                                                                    if (monthmodenbr == "1") {
                                                                        $("#MonthdayNbr").prop('disabled', false);
                                                                    }
                                                                    if (monthmodenbr == "2") {
                                                                        $("#MonthdayNbr").prop('disabled', true);
                                                                        $("#MonthondayNbr").prop('disabled', false);
                                                                        $("#MonthonNbr").prop('disabled', false);
                                                                    }
                                                                }
                                                                else {
                                                                    $(".monthly").hide();
                                                                    $(".weekly").hide();
                                                                }
                                                            }
                                                            $('input[type=radio][name=IsRecurringInd]').change(function () {
                                                                if (this.value == 'True') {
                                                                    $(".recurring").show();
                                                                    $(".recurringenddate").show();
                                                                }
                                                                else if (this.value == '' || this.value == 'False') {
                                                                    $(".rbRecurrenceTypeNbr").prop('checked', false);
                                                                    $(".chkweekdays").prop('checked', false);
                                                                    $(".rbMonthModeNbr").prop('checked', false);
                                                                    $("#MonthdayNbr").val('');
                                                                    $("#MonthdayNbr").prop('disabled', true);
                                                                    $("select#MonthondayNbr")[0].selectedIndex = 0;
                                                                    $("select#MonthonNbr")[0].selectedIndex = 0;
                                                                    $("#MonthondayNbr").prop('disabled', true);
                                                                    $("#MonthonNbr").prop('disabled', true);
                                                                    $(".recurring").hide();
                                                                    $(".weekly").hide();
                                                                    $(".monthly").hide();
                                                                    $(".recurringenddate").hide();
                                                                }
                                                            });
                                                            $('input[type=radio][name=RecurrenceTypeNbr]').change(function () {
                                                                if (this.value == '2') {
                                                                    $(".weekly").show();
                                                                    $(".monthly").hide();
                                                                }
                                                                else if (this.value == '3') {
                                                                    $(".monthly").show();
                                                                    $(".weekly").hide();
                                                                }
                                                                else {
                                                                    $(".monthly").hide();
                                                                    $(".weekly").hide();
                                                                }
                                                            });
                                                            $('input[type=radio][name=MonthModeNbr]').change(function () {
                                                                if (this.value == '1') {
                                                                    $("#MonthdayNbr").prop('disabled', false);
                                                                    $("#MonthondayNbr").prop('disabled', true);
                                                                    $("#MonthonNbr").prop('disabled', true);
                                                                }
                                                                else if (this.value == '2') {
                                                                    $("#MonthdayNbr").removeClass('input-validation-error');
                                                                    $("#MonthdayNbr").addClass('field-validation-valid');
                                                                    $("#MonthdayNbr").removeClass('field-validation-error');
                                                                    $('span[data-valmsg-for="MonthdayNbr"]').text('');
                                                                    $("#MonthdayNbr").prop('disabled', true);
                                                                    $("#MonthondayNbr").prop('disabled', false);
                                                                    $("#MonthonNbr").prop('disabled', false);
                                                                }
                                                            });
                                                        });

                                                        function setformOncahnge(isactive) {
                                                            if (isactive == "True" || isactive == "true") {
                                                                $('.tblpagetitle').hide();
                                                                $('.metatitle').hide();
                                                                $('.tblexternalLink').show();
                                                                $('.dvinnerimage').hide();
                                                                $('#ImageIDErrmsg').hide();
                                                                $('.common-fieldset').hide();
                                                            }
                                                            else {
                                                                $('.tblpagetitle').show();
                                                                $('.metatitle').show();
                                                                $('.tblexternalLink').hide();
                                                                $('.dvinnerimage').show();
                                                                $('#ImageIDErrmsg').hide();
                                                                $('.common-fieldset').show();
                                                            }
                                                            $('.field-validation-error').empty();
                                                            $('.input-validation-error').each(function () {
                                                                $(this).removeClass('input-validation-error');
                                                            });
                                                        }

                                                        function setform(isactive) {
                                                            if (isactive == "True" || isactive == "true") {
                                                                $('.tblpagetitle').hide();
                                                                $('.metatitle').hide();
                                                                $('.tblexternalLink').show();
                                                                $('.dvinnerimage').hide();
                                                                $('.common-fieldset').hide();
                                                            }
                                                            else {
                                                                $('.tblpagetitle').show();
                                                                $('.metatitle').show();
                                                                $('.tblexternalLink').hide();
                                                                $('.dvinnerimage').show();
                                                                $('.common-fieldset').show();
                                                            }
                                                        }

                                                        $('.chkweekdays').change(function () {
                                                            if ($(".chkweekdays:checkbox:checked").length > 0) {
                                                                $("#spnerrchkdays").text("");
                                                                return true;
                                                            }
                                                            else {
                                                                $("#spnerrchkdays").text("This field is required.");
                                                                return false;
                                                            }
                                                        });
                                                        // Set Focus on URLTxt field on Postback
                                                        $(document).ready(function () {
                                                            var retfalse = 0;
                                                            var urlfocus = '@ViewBag.FocusPageUrl';
                                                            if (urlfocus.toLowerCase() == "true") {
                                                                $("#PageURLTxt").focus();
                                                            }
                                                            $('#btnsubmit').on("click", function () {
                                                               var retfalse = 0;
                                                                if ($('.cropedfileupload').val() == '' && ('@Model.ImageURLTxt' == '' || '@Model.ImageURLTxt' == null)) {
                                                                    $('#input_file_upload_error_img1').show();
                                                                    retfalse = 1;
                                                                }
                                                                else {
                                                                    $('#input_file_upload_error_img1').hide();
                                                                }
                                                                //Code to check dispaly dates comaprision
                                                                var h_start_time = $('#DisplayStartDate').val();
                                                                var h_end_time = $('#DisplayEndDate').val();

                                                                if (h_start_time != '' && h_end_time != '') {
                                                                    if (new Date(h_start_time) >= new Date(h_end_time)) {
                                                                        $('#spnHome').text('Display End Date & Time should be greater than Display Start Date & Time.');
                                                                        retfalse = 1;
                                                                    }
                                                                    else {
                                                                        $('#spnHome').text('');
                                                                    }
                                                                }
                                                                var RecurrenceTypeNbr = $('input[name=RecurrenceTypeNbr]:checked').val();
                                                                if (RecurrenceTypeNbr == "2") {
                                                                    if ($('.chkweekdays').filter(':checked').length < 1) {
                                                                        retfalse = 1;
                                                                        $('#spnerrchkdays').text("This field is required.");
                                                                    }
                                                                    else {
                                                                        $('#spnerrchkdays').text("");
                                                                    }
                                                                    if ($('.chkweekdays').filter(':checked').length < 1) {
                                                                        retfalse = 1;
                                                                        $('#spnerrchkdays').text("This field is required.");
                                                                    }
                                                                    else {
                                                                        $('#spnerrchkdays').text("");
                                                                    }
                                                                }
                                                                else if (RecurrenceTypeNbr == "3") {

                                                                }
                                                                if ($("#form1").valid()) {
                                                                    if (retfalse == 1) {
                                                                        return false;
                                                                    }
                                                                }
                                                            });
                                                        });

                                                        function ddlInnerImagesChange(value) {
                                                            if (value == '') {
                                                                CKEDITOR.instances['AbstractTxtInner'].setData('');
                                                                $('#AltBannerImageTxt').val('');
                                                            }
                                                            else {
                                                                $.ajax({
                                                                    url: '@AppPath' + 'Menu/GetDataForInnerImages',
                                                                    data: { ImgId: value },
                                                                    type: 'Get',
                                                                    success: function (result) {
                                                                        CKEDITOR.instances['AbstractTxtInner'].setData(result.AbstractTxt);
                                                                        $("#AltBannerImageTxt").val(result.AltImageTxt);
                                                                        $('#AltImageTxt').removeClass("input-validation-error");
                                                                        $('#bannerAltImageTxt').css({ "display": "none" });
                                                                        return false;
                                                                    },
                                                                    onerror: function () {
                                                                    }
                                                                });
                                                            }
                                                        }
                                                        // Alt banner image txt validation
                                                        $(document).click(function () {
                                                            if ($('#AltImageTxt').val() == '') {
                                                                $('#bannerAltImageTxt').css({ "display": "block" });
                                                            }
                                                        })
                                                        
                                                    </script>

                                                    <script type="text/javascript">
                                                        $(function () {
                                                            $('.datepicker').datepicker(
                                                                {
                                                                    changeMonth: true,
                                                                    changeYear: true,
                                                                    yearRange: (new Date().getFullYear() - 10).toString() + ':' + (new Date().getFullYear() + 10).toString()
                                                                });
                                                            $('.datetimepicker').datetimepicker({
                                                                format: 'm/d/Y h:i A',
                                                                step: 1
                                                            });
                                                        });
                                                        $("[id$=btnExport]").click(function (e) {
                                                            window.open('data:application/vnd.ms-excel,' + encodeURIComponent($('div[id$=err_messages]').html()));
                                                            e.preventDefault();
                                                        });
                                                    </script>
                                                    <script>
                                                        CKEDITOR.env.isCompatible = true;
                                                    </script>
                                                    }